<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Настольная игра 2026: Online Lobby</title>
    <!-- Firebase SDK (обязательно в этом порядке) -->
    <script src="www.gstatic.com"></script>
    <script src="www.gstatic.com"></script>
    <style>
        body { font-family: 'Segoe UI', sans-serif; display: flex; flex-direction: column; align-items: center; background: #2c3e50; color: white; margin: 0; padding: 20px; }
        .screen { background: #34495e; padding: 30px; border-radius: 15px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.4); min-width: 400px; }
        .hidden { display: none !important; }
        input { padding: 12px; border-radius: 6px; border: none; width: 250px; margin-bottom: 15px; font-size: 16px; }
        button { padding: 12px 24px; cursor: pointer; background: #3498db; color: white; border: none; border-radius: 6px; font-weight: bold; margin: 5px; transition: 0.2s; }
        button:hover { background: #2980b9; }
        .room-btn { background: #27ae60; width: 100%; margin-top: 10px; }
        #player-list { text-align: left; background: #1a252f; padding: 15px; border-radius: 10px; margin: 15px 0; }
        /* Игровое поле из прошлых версий */
        #board { display: grid; grid-template-columns: repeat(10, 70px); gap: 5px; background: #34495e; padding: 15px; border-radius: 10px; }
        .cell { width: 70px; height: 70px; background: #ecf0f1; color: #2c3e50; display: flex; align-items: center; justify-content: center; font-weight: bold; border-radius: 5px; position: relative; }
    </style>
</head>
<body>

    <h1 style="margin-bottom: 30px;">PRO Game 2026 Online</h1>

    <!-- 1. ГЛАВНОЕ МЕНЮ (ВВОД ИМЕНИ) -->
    <div id="menu-screen" class="screen">
        <h2>Добро пожаловать!</h2>
        <input type="text" id="userName" placeholder="Введите ваше имя">
        <br>
        <button onclick="showRoomSelection()">Продолжить</button>
    </div>

    <!-- 2. ВЫБОР КОМНАТЫ -->
    <div id="room-screen" class="screen hidden">
        <h2 id="hello-user">Привет!</h2>
        <button class="room-btn" onclick="createRoom()">СОЗДАТЬ НОВУЮ КОМНАТУ</button>
        <div style="margin: 20px 0; opacity: 0.5;">— ИЛИ —</div>
        <input type="text" id="joinRoomId" placeholder="Введите ID комнаты">
        <button onclick="joinRoom()">ВОЙТИ</button>
    </div>

    <!-- 3. ЛОББИ ОЖИДАНИЯ -->
    <div id="lobby-screen" class="screen hidden">
        <h2 id="display-room-id">Комната: ...</h2>
        <div id="player-list"></div>
        <button id="readyBtn" onclick="toggleReady()">Я ГОТОВ</button>
        <button id="startBtn" class="hidden" style="background:#27ae60;" onclick="sendStartSignal()">НАЧАТЬ ИГРУ</button>
        <p style="font-size: 12px; color: #bdc3c7; margin-top: 15px;">Отправьте ID комнаты другу для входа</p>
    </div>

    <!-- 4. ИГРОВАЯ ЗОНА -->
    <div id="game-area" class="hidden">
        <!-- Поле и управление здесь -->
        <div id="board"></div>
        <div style="margin-top: 20px; text-align: center;">
            <div id="turn-info">Ожидание хода...</div>
            <button id="diceBtn" onclick="rollDice()">БРОСИТЬ КУБИК</button>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCIBxBjacSQcuB6gJvVIBbIwmiM1Aq988k",
            authDomain: "game-e7b33.firebaseapp.com",
            databaseURL: "https://game-e7b33-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "game-e7b33",
            storageBucket: "game-e7b33.firebasestorage.app",
            messagingSenderId: "32405712618",
            appId: "1:32405712618:web:81a8ba0a3bb6a7366c3193"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        let myName = "";
        let currentRoomId = "";
        let myId = 'u' + Math.random().toString(36).substring(2, 9);

        // Показать меню выбора комнат
        function showRoomSelection() {
            myName = document.getElementById('userName').value.trim();
            if (!myName) return alert("Введите имя!");
            document.getElementById('menu-screen').classList.add('hidden');
            document.getElementById('room-screen').classList.remove('hidden');
            document.getElementById('hello-user').innerText = `Привет, ${myName}!`;
        }

        // Создать комнату
        function createRoom() {
            const id = Math.random().toString(36).substring(2, 7).toUpperCase();
            enterRoom(id);
        }

        // Войти в комнату
        function joinRoom() {
            const id = document.getElementById('joinRoomId').value.trim().toUpperCase();
            if (!id) return alert("Введите ID!");
            enterRoom(id);
        }

        function enterRoom(id) {
            currentRoomId = id;
            document.getElementById('room-screen').classList.add('hidden');
            document.getElementById('lobby-screen').classList.remove('hidden');
            document.getElementById('display-room-id').innerText = "ID КОМНАТЫ: " + id;
            
            const roomRef = db.ref('rooms/' + id);
            
            // Записываем себя
            roomRef.child('players').child(myId).set({
                name: myName,
                ready: false,
                joinedAt: Date.now()
            });

            // Слушаем обновления
            roomRef.on('value', snap => {
                const data = snap.val();
                if (!data) return;
                updateLobbyUI(data.players, data.status);
                if (data.status === 'playing') startGameUI();
            });
        }

        function updateLobbyUI(players, status) {
            const list = document.getElementById('player-list');
            list.innerHTML = "";
            let allReady = true;
            let count = 0;
            let firstPlayer = null;

            for (let id in players) {
                count++;
                const p = players[id];
                if (!p.ready) allReady = false;
                if (!firstPlayer || p.joinedAt < players[firstPlayer].joinedAt) firstPlayer = id;

                list.innerHTML += `<div>${p.name} ${p.ready ? '✅' : '⏳'}</div>`;
            }

            if (myId === firstPlayer && allReady && count >= 1) {
                document.getElementById('startBtn').classList.remove('hidden');
            } else {
                document.getElementById('startBtn').classList.add('hidden');
            }
        }

        function toggleReady() {
            const ready = players[myId] ? !players[myId].ready : true; // упрощенно
            db.ref('rooms/' + currentRoomId + '/players/' + myId).update({ ready: true });
        }

        function sendStartSignal() {
            db.ref('rooms/' + currentRoomId).update({ status: 'playing' });
        }

        function startGameUI() {
            document.getElementById('lobby-screen').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');
            // Здесь ваша логика отрисовки поля
        }
    </script>
</body>
</html>
